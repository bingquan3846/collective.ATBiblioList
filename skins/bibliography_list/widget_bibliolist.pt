<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
  <head><title></title></head>
  <body>

    <!-- BiblioList Widget -->
    <metal:view_macro define-macro="view"
        tal:define="bl_tool here/portal_bibliolist;
                    format here/getPresentationFormat;
                    uids python:getattr(here, field.edit_accessor)();
                    formatted_list python:bl_tool.formatList(uids, format);
                    listing_type here/ListingType">

      <ul tal:condition="python:listing_type=='bulleted'">
        <li tal:repeat="ref formatted_list"
            tal:content="structure ref" />
      </ul>
      <ol tal:condition="python:listing_type=='ordered'">
        <li tal:repeat="ref formatted_list"
            tal:content="structure ref" />
      </ol>
      <div tal:condition="python:listing_type=='lines'"
           tal:repeat="ref formatted_list"
           tal:content="structure ref" />
	  <table class="listing"
			 tal:condition="python:listing_type=='table' and formatted_list != ()">
		<thead>
		  <th i18n:translate="">Bibliography References</th>
		</thead>
		<tbody>
		  <tal:block repeat="ref formatted_list">
			<tr tal:define="oddrow repeat/ref/odd;"
				tal:attributes="class python:test(oddrow, 'even', 'odd')" >
			  <td tal:content="structure ref" />
			</tr>
		  </tal:block>
		</tbody>
	  </table>
    
    </metal:view_macro>
    <div metal:define-macro="edit">
      <div metal:use-macro="here/widgets/field/macros/edit">
    <div metal:fill-slot="widget_body"
         tal:define="searchterm python: request.get('searchterm','');
                     references python: request.get('references',None);
                     uids python:getattr(here, field.edit_accessor)();
                     old python:[here.archetype_tool.lookupObject(uid=uid) for uid in uids];
                     results python:here.searchMatchingReferences(searchterm)">

      <fieldset>
        <legend>Listed References</legend>
        <p tal:condition="not:old">Nothing in the bibliography list yet</p>

        <div tal:condition="old"> <!-- Edit existing references -->
          <table class="listing">
            <thead>
			  <th class="nosort"><input class="noborder"
										type="checkbox"
										src="select_all_icon.gif"
										name="selectButton"
										title="Select all items"
										onClick="toggleSelect(this, id='modReferences:list');"
										tal:attributes="src string:$portal_url/select_all_icon.gif"
										alt="Select all items"
										i18n:attributes="title alt"
										/>
			  </th>
              <th i18n:translate="">Existing references</th>
            </thead>
            <tbody>
              <tal:block repeat="item old">
              <tr tal:define="oddrow repeat/item/odd;"
                  tal:attributes="class python:test(oddrow, 'even', 'odd')" >
                <td><input type="checkbox"
                           name="modReferences:list"
                           tal:attributes="value item/UID"/></td>
                <td><a tal:attributes="href item/absolute_url"
                       tal:content="item/title_or_id">item title or id</a></td>
              </tr>
              </tal:block>
            </tbody>
          </table>
          <input type="submit" name="form.button.reference_delete" value="Delete"/>
          <input type="submit" name="form.button.reference_up" value="Up"/>
          <input type="submit" name="form.button.reference_down" value="Down"/>
        
<!--
        <table> <tr> <th colspan=2> sort: </th> </tr>
        <tr> <th> by: </th> <td><select name="sortlist:list">
        <option value="('publication_year', 'cmp', 'desc')"> publication_year </option>
        <option value="('Authors', 'nocase', 'asc'))"> Authors </option>
        <option value="('Source', 'nocase', 'asc'))"> Source </option>
        </select> </td>
        <tr> <th> and: </th> <td><select name="sortlist:list">
        <option value=""> -------none-------</option>
        <option value=",('publication_year', 'cmp', 'desc')"> publication_year </option>
        <option value=",('Authors', 'nocase', 'asc'))"> Authors </option>
        <option value=",('Source', 'nocase', 'asc'))"> Source </option>
        </select></td>
        <tr> <th> and: </th> <td><select name="sortlist:list">
        <option value=""> -------none-------</option>
        <option value=",('publication_year', 'cmp', 'desc')"> publication_year </option>
        <option value=",('Authors', 'nocase', 'asc'))"> Authors </option>
        <option value=",('Source', 'nocase', 'asc'))"> Source </option>
        </select></td>
        </table>
        <input type="submit" name="form.button.reference_sort" value="Sort"/>
-->

        </div> <!-- end editing existing references -->
      </fieldset>

      <fieldset> <!-- search/add new references -->
        <legend>Search/Add references</legend>

        <input name="searchterm" tal:attributes="value searchterm|nothing" />&nbsp;
        <input type="submit" name="form.button.reference_search" value="Search" />

        <tal:block condition="searchterm">
          <table class="listing"
                  tal:condition="results">
            <thead>
			  <th class="nosort"><input class="noborder"
										type="checkbox"
										src="select_all_icon.gif"
										name="selectButton"
										title="Select all items"
										onClick="toggleSelect(this, id='references:list');"
										tal:attributes="src string:$portal_url/select_all_icon.gif"
										alt="Select all items"
										i18n:attributes="title alt"
										/>
			  </th>
              <th i18n:translate="">Found references</th>
            </thead>
            <tbody>
              <tal:block repeat="item results">
                <tal:block define="item item/getObject;">

                <tr tal:define="oddrow repeat/item/odd;"
                    tal:attributes="class python:test(oddrow, 'even', 'odd')" >
                  <td><input type="checkbox"
                             name="references:list"
                             tal:attributes="value item/UID"/></td>
                  <td><a tal:attributes="href item/absolute_url"
                         tal:content="item/title_or_id">item title or id</a></td>
                </tr>
                </tal:block>
              </tal:block>
            </tbody>
          </table>
          <input type="submit" name="form.button.reference_add" value="Add to list"
                 tal:condition="results" />
        </tal:block>

        <p tal:condition="not:results">No matching bibliographic reference found.
           Please try another search term.</p>
      </fieldset> <!-- end search/add new references -->

    </div>
      </div>
    </div>

    <div metal:define-macro="search">
      <div metal:use-macro="here/authors_widget/macros/edit"></div>
    </div>

</body>
</html>
